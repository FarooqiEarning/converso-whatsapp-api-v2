# Prometheus configuration example for Converso Whatsapp Api
# Copy this file to prometheus.yml and adjust the settings

global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  # - "first_rules.yml"
  # - "second_rules.yml"

scrape_configs:
  # Converso Whatsapp Api metrics
  - job_name: 'converso-whatsapp-api'
    static_configs:
      - targets: ['localhost:8080']  # Adjust to your Converso Whatsapp Api URL
    
    # Metrics endpoint path
    metrics_path: '/metrics'
    
    # Scrape interval for this job
    scrape_interval: 30s
    
    # Basic authentication (if METRICS_AUTH_REQUIRED=true)
    basic_auth:
      username: 'prometheus'  # Should match METRICS_USER
      password: 'secure_random_password_here'  # Should match METRICS_PASSWORD
    
    # Optional: Add custom labels
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: localhost:8080  # Converso Whatsapp Api address

# Alerting configuration (optional)
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          # - alertmanager:9093

# Example alert rules for Converso Whatsapp Api
# Create a file called converso-whatsapp-api_alerts.yml with these rules:
#
# groups:
#   - name: converso-whatsapp-api
#     rules:
#       - alert: converso-whatsapp-apiAPIDown
#         expr: up{job="converso-whatsapp-api"} == 0
#         for: 1m
#         labels:
#           severity: critical
#         annotations:
#           summary: "Converso Whatsapp Api is down"
#           description: "Converso Whatsapp Api has been down for more than 1 minute."
#       
#       - alert: converso-whatsapp-apiInstanceDown
#         expr: converso-whatsapp-api_instance_up == 0
#         for: 2m
#         labels:
#           severity: warning
#         annotations:
#           summary: "converso-whatsapp-api instance {{ $labels.instance }} is down"
#           description: "Instance {{ $labels.instance }} has been down for more than 2 minutes."
#       
#       - alert: HighInstanceCount
#         expr: converso-whatsapp-api_instances_total > 100
#         for: 5m
#         labels:
#           severity: warning
#         annotations:
#           summary: "High number of converso-whatsapp-api instances"
#           description: "Converso Whatsapp Api is managing {{ $value }} instances."
